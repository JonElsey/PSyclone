MINI_APP_DIR=${HOME}/Projects/LFRic/NGMS-SoftwareStack/buildScripts/Linux/GCC10/trunk/miniapps/skeleton

# Strip out '_tweaked' and any leading directory name to get the original
# name of the TL kernel.
KFILE=$(subst _tweaked,,${KERNEL_FILE})
KFILE_NO_DIR=$(KFILE:tangent_linear/%=%)

all:
	psyad -api 'dynamo0.3' ${KERNEL_FILE} -otest ${HARNESS_FILE} ${GEOM_ARGS} -a ${ACTIVE_VARS}
	cp -f ${HARNESS_FILE} ${MINI_APP_DIR}/source/algorithm/adjoint_test_mod.x90
	cp -f ${KERNEL_FILE} ${MINI_APP_DIR}/source/kernel/${KFILE_NO_DIR}
	cp -f ${ADJ_FILE} ${MINI_APP_DIR}/source/kernel/.
	make -C ${MINI_APP_DIR} clean
	make -C ${MINI_APP_DIR} build
	cd ${MINI_APP_DIR}/example; ../bin/skeleton configuration.nml

